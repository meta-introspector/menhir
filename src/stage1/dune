;; Build the stage1 version of Menhir. During this stage, Menhir's parser
;; is generated by ocamlyacc.

(ocamlyacc parser)

;; As dune cannot use the same OCaml module in two different libraries or
;; executables, we must copy the source files to the present directory.

(copy_files# ../*.{ml,mli})

;; The stage1 version of Menhir. This executable is later used to build the
;; stage2 version of Menhir.

(executable
  (name main)
  (libraries
    unix
    vendored_fix
    vendored_pprint
    menhirLib menhirSdk
  )
    (preprocess
   (pps
;;      graphql_ppx
      ;;      js_of_ocaml-ppx
      js_of_ocaml-ppx
      ppx_log
      ppx_deriving_yaml
      refl
      ppx_expect
      ppx_bench
      ppx_compare
      ppx_deriving.create
      ppx_deriving.enum
      ppx_deriving.eq
      ppx_deriving.fold
      ppx_deriving.iter
      ppx_deriving.ord
      ppx_deriving.show
      ppx_deriving_yojson
      ppx_fields_conv
      ppx_hash
      ppx_inline_test
      ppx_jane
      ppx_jsobject_conv
;      ppx_profiling
      ppx_protocol_conv
      ppx_sexp_conv
;      ppx_stage
;      ppx_tools.metaquot
;      ppx_yojson_conv
  ;    ppxlib.metaquot
 ;     profiling.ppx
      visitors.ppx
   ))
  (flags :standard -open MenhirSdk)
)
